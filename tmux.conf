# --- basics ---
set -g mouse off
set -s escape-time 0
setw -g aggressive-resize on
setw -g window-size latest

# prefix (keep default)
set -g prefix C-b

# -- base index to 1
setw -g pane-base-index 1
setw -g base-index 1

# -- don't rename window names
setw -g automatic-rename off

# Prefer zsh if installed; otherwise keep current shell
if -b 'command -v zsh >/dev/null 2>&1' \
     'set -g default-shell "/usr/bin/zsh"' \
     'set -g default-shell "$SHELL"'

# --- OSC 52 clipboard integration ---
set -g set-clipboard off  # let our OSC 52 do the copying

# define a small shell snippet that safely sends OSC 52
set -g @osc52-cmd 'printf "\033]52;c;%s\007" "$(base64 | tr -d "\r\n")"'

# -- plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @resurrect-processes 'ssh autossh mosh-client'
run '~/.tmux/plugins/tpm/tpm'

# -- vi mode
setw -g mode-keys vi
set-option -g status-keys vi
set-window-option -g mode-keys vi

# -- easy copy mode
bind-key u copy-mode
unbind-key [
bind-key p paste-buffer
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi V send -X select-line
bind -T copy-mode-vi Escape send -X cancel
# bind -T copy-mode-vi y send -X copy-selection
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "#{@osc52-cmd}"
bind -T copy-mode-vi Y send -X copy-line

# also make Enter copy selection to clipboard (handy)
bind -T copy-mode-vi Enter send -X copy-pipe-and-cancel "#{@osc52-cmd}"

# Optional: when using the mouse to select in copy-mode, copy on release
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel "#{@osc52-cmd}"

# -- don't change circle layouts
unbind-key Space

# -- circle windows
unbind-key C-o
bind-key g rotate

# -- move to last window (faster then C-b a that tmux-sensible use)
unbind-key a
bind-key C-b last-window

# -- create window with name prompt
bind-key C command-prompt -p "Name of new window: " "new-window -n '%%'"

# --- pane navigation (vim-like) ---
bind-key j select-pane -D
bind-key h select-pane -L
bind-key k select-pane -U
bind-key l select-pane -R

# resize with Alt + h/j/k/l
bind -n M-h resize-pane -L 5
bind -n M-j resize-pane -D 5
bind -n M-k resize-pane -U 5
bind -n M-l resize-pane -R 5

# --- window navigation (vim-like) ---
bind-key H previous-window
bind-key L next-window

# -- create panes like vim window
bind-key s split-window
bind-key v split-window -h

# -- rebind choose-session as S
bind-key S choose-session

# -- toggle mouse off/on with M
bind-key M set -g mouse\; display-message "mouse is now #{?mouse,on,off}"

# --- QoL ---
bind r source-file ~/.tmux.conf \; display-message "tmux.conf reloaded"

